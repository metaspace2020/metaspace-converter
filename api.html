<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>API &mdash; METASPACE Converter  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx-codeautolink.css?v=125d5c1c" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Welcome to METASPACE Converter’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            METASPACE Converter
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-metaspace_converter">metaspace_converter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#metaspace_converter.anndata_to_image_array"><code class="docutils literal notranslate"><span class="pre">anndata_to_image_array()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#metaspace_converter.metaspace_to_anndata"><code class="docutils literal notranslate"><span class="pre">metaspace_to_anndata()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#metaspace_converter.metaspace_to_spatialdata"><code class="docutils literal notranslate"><span class="pre">metaspace_to_spatialdata()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-metaspace_converter.colocalization">metaspace_converter.colocalization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#metaspace_converter.colocalization.coloc_ml_preprocessing"><code class="docutils literal notranslate"><span class="pre">coloc_ml_preprocessing()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#metaspace_converter.colocalization.colocalization"><code class="docutils literal notranslate"><span class="pre">colocalization()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">METASPACE Converter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">API</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/api.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="api">
<h1>API<a class="headerlink" href="#api" title="Link to this heading"></a></h1>
<section id="module-metaspace_converter">
<span id="metaspace-converter"></span><h2>metaspace_converter<a class="headerlink" href="#module-metaspace_converter" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="metaspace_converter.anndata_to_image_array">
<span class="sig-prename descclassname"><span class="pre">metaspace_converter.</span></span><span class="sig-name descname"><span class="pre">anndata_to_image_array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/metaspace_converter/anndata_to_array.html#anndata_to_image_array"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#metaspace_converter.anndata_to_image_array" title="Link to this definition"></a></dt>
<dd><p>Extracts an array of ion images from an AnnData object
(that has been generated through the <code class="docutils literal notranslate"><span class="pre">metaspace_to_anndata</span></code> function).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://anndata.readthedocs.io/en/stable/generated/anndata.AnnData.html#anndata.AnnData" title="(in anndata v0.1.dev50+gce7fc76)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></a></span>) – An AnnData object.</p></li>
<li><p><strong>layer</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>]</span>) – <code class="docutils literal notranslate"><span class="pre">AnnData.layer</span></code> that should be extracted to an image array.
Default is None, which means that <code class="docutils literal notranslate"><span class="pre">adata.X</span></code> will be used.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.26)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a></span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>A three-dimensional Numpy array in the following shape</p>
<blockquote>
<div><ul class="simple">
<li><p>Dimension 0: Number of ion images in the order of <code class="docutils literal notranslate"><span class="pre">adata.var_names</span></code></p></li>
<li><p>Dimension 1: Image height <code class="docutils literal notranslate"><span class="pre">adata.uns[&quot;metaspace&quot;][&quot;image_size&quot;][&quot;y&quot;]</span></code></p></li>
<li><p>Dimension 2: Image width <code class="docutils literal notranslate"><span class="pre">adata.uns[&quot;metaspace&quot;][&quot;image_size&quot;][&quot;x&quot;]</span></code></p></li>
</ul>
</div></blockquote>
</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.12)"><strong>ValueError</strong></a> – If the AnnData object has been modified.
    E.g. Pixel have been removed/added and the number of pixels
    and their coordinates do not match the original image dimensions.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="metaspace_converter.metaspace_to_anndata">
<span class="sig-prename descclassname"><span class="pre">metaspace_converter.</span></span><span class="sig-name descname"><span class="pre">metaspace_to_anndata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">database</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fdr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_tic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata_as_obs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_optical_image</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">annotation_filter</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/metaspace_converter/to_anndata.html#metaspace_to_anndata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#metaspace_converter.metaspace_to_anndata" title="Link to this definition"></a></dt>
<dd><p>Downloads a METASPACE dataset to an <code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code> object.</p>
<p>See: <a class="reference external" href="https://metaspace2020.eu/about">https://metaspace2020.eu/about</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://metaspace2020.readthedocs.io/en/latest/content/apireference/sm_annotation_utils.html#metaspace.sm_annotation_utils.SMDataset" title="(in metaspace2020)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMDataset</span></code></a>]</span>) – A METASPACE dataset instance. If not provided, the <cite>dataset_id</cite> must be given.</p></li>
<li><p><strong>dataset_id</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>]</span>) – The unique ID of a dataset on METASPACE, e.g. “2021-09-03_11h43m13s”</p></li>
<li><p><strong>database</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>]]</span>) – A single METASPACE database given as a tuple of name and version. Usually it is
displayed on METASPACE as “HMDB – v4” which corresponds to <cite>(“HMDB”, “v4”)</cite>.</p></li>
<li><p><strong>fdr</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>]</span>) – Returns only annotations for which the false discovery rate is less or equal to this
limit.</p></li>
<li><p><strong>use_tic</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></span>) – When True, the output values will be scaled by the total ion count per pixel and
will be in 0.0 to 1.0 range.</p></li>
<li><p><strong>metadata_as_obs</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></span>) – Whether to store metadata in the <cite>obs</cite> dataframe instead of <cite>uns</cite>. For a
single METASPACE dataset, metadata is the same for all pixels, so it would be duplicated
for all <cite>obs</cite>. When combining multiple datasets, it would be preserved in <cite>obs</cite> but
not in <cite>uns</cite>.</p></li>
<li><p><strong>add_optical_image</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></span>) – Whether to embed the optical image for SquidPy</p></li>
<li><p><strong>sm</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://metaspace2020.readthedocs.io/en/latest/content/apireference/sm_annotation_utils.html#metaspace.sm_annotation_utils.SMInstance" title="(in metaspace2020)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMInstance</span></code></a>]</span>) – Optionally a cached SMInstance</p></li>
<li><p><strong>annotation_filter</strong> – Additional keyword arguments passed to the METASPACE API.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://anndata.readthedocs.io/en/stable/generated/anndata.AnnData.html#anndata.AnnData" title="(in anndata v0.1.dev50+gce7fc76)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></a></span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>An <code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code> object with</dt><dd><ul class="simple">
<li><p>ion intensities: <code class="docutils literal notranslate"><span class="pre">.X</span></code></p></li>
<li><p>ion image pixel coordinates: <code class="docutils literal notranslate"><span class="pre">.obs[[&quot;ion_image_pixel_x&quot;,</span> <span class="pre">&quot;ion_image_pixel_y&quot;]]</span></code></p></li>
<li><p>spatial coordinates: <code class="docutils literal notranslate"><span class="pre">.obsm[&quot;spatial&quot;]</span></code></p></li>
<li><p>ion properties: <code class="docutils literal notranslate"><span class="pre">.var</span></code>, for example “formula”, “adduct”, “mz”, “fdr”,
“moleculeNames”, “moleculeIds”, “intensity”…</p></li>
<li><p>METASPACE metadata: <code class="docutils literal notranslate"><span class="pre">.uns[&quot;metaspace&quot;]</span></code> if not <code class="docutils literal notranslate"><span class="pre">metadata_as_obs</span></code></p></li>
<li><p>SquidPy metadata: <code class="docutils literal notranslate"><span class="pre">.uns[&quot;spatial&quot;]</span></code> if <code class="docutils literal notranslate"><span class="pre">add_optical_image</span></code></p></li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.12)"><strong>ValueError</strong></a> – If something is wrong with the input data or parameters</p></li>
<li><p><a class="reference external" href="https://metaspace2020.readthedocs.io/en/latest/content/apireference/sm_annotation_utils.html#metaspace.sm_annotation_utils.DatasetNotFound" title="(in metaspace2020)"><strong>metaspace.sm_annotation_utils.DatasetNotFound</strong></a> – If the dataset ID is not found</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ConnectionError" title="(in Python v3.12)"><strong>ConnectionError</strong></a> – For any other network connectivity problems</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="metaspace_converter.metaspace_to_spatialdata">
<span class="sig-prename descclassname"><span class="pre">metaspace_converter.</span></span><span class="sig-name descname"><span class="pre">metaspace_to_spatialdata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">database</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fdr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_tic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata_as_obs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_optical_image</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optical_name_added</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'optical_image'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_points</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">points_name_added</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'maldi_points'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">annotation_filter</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/metaspace_converter/to_spatialdata.html#metaspace_to_spatialdata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#metaspace_converter.metaspace_to_spatialdata" title="Link to this definition"></a></dt>
<dd><p>Download a METASPACE dataset as a <code class="xref py py-class docutils literal notranslate"><span class="pre">SpatialData</span></code> object.</p>
<p>See: <a class="reference external" href="https://metaspace2020.eu/about">https://metaspace2020.eu/about</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://metaspace2020.readthedocs.io/en/latest/content/apireference/sm_annotation_utils.html#metaspace.sm_annotation_utils.SMDataset" title="(in metaspace2020)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMDataset</span></code></a>]</span>) – A METASPACE dataset instance. If not provided, the <code class="docutils literal notranslate"><span class="pre">dataset_id</span></code> must be given.</p></li>
<li><p><strong>dataset_id</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>]</span>) – The unique ID of a dataset on METASPACE, e.g. “2021-09-03_11h43m13s”</p></li>
<li><p><strong>database</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>]]</span>) – A single METASPACE database given as a tuple of name and version. Usually it is
displayed on METASPACE as “HMDB – v4” which corresponds to <code class="docutils literal notranslate"><span class="pre">(&quot;HMDB&quot;,</span> <span class="pre">&quot;v4&quot;)</span></code>.</p></li>
<li><p><strong>fdr</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a></span>) – Returns only annotations for which the false discovery rate is less or equal to this
limit.</p></li>
<li><p><strong>use_tic</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></span>) – When True, the output values will be scaled by the total ion count per pixel and
will be in 0.0 to 1.0 range.</p></li>
<li><p><strong>metadata_as_obs</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></span>) – Whether to store metadata in the <code class="docutils literal notranslate"><span class="pre">obs</span></code> dataframe instead of <code class="docutils literal notranslate"><span class="pre">uns</span></code>. For
a single METASPACE dataset, metadata is the same for all pixels, so it would be
duplicated for all <code class="docutils literal notranslate"><span class="pre">obs</span></code>. When combining multiple datasets, it would be preserved in
<code class="docutils literal notranslate"><span class="pre">obs</span></code> but not in <code class="docutils literal notranslate"><span class="pre">uns</span></code>.</p></li>
<li><p><strong>add_optical_image</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></span>) – Whether to also add the optical image (if one exists) to SpatialData
images. If none exists, it is not added, and no error raised.</p></li>
<li><p><strong>optical_name_added</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a></span>) – Name of the element where to store the image in the SpatialData object</p></li>
<li><p><strong>add_points</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></span>) – Whether to also add ion image pixel coordinates as SpatialData points. This
allows to spatially visualize the ion image values. If False, only ion intensities are
added to the table and coordinates are added to <code class="docutils literal notranslate"><span class="pre">obs</span></code>.</p></li>
<li><p><strong>points_name_added</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a></span>) – Name of the element where to store the points in the SpatialData object</p></li>
<li><p><strong>sm</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://metaspace2020.readthedocs.io/en/latest/content/apireference/sm_annotation_utils.html#metaspace.sm_annotation_utils.SMInstance" title="(in metaspace2020)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMInstance</span></code></a>]</span>) – Optionally a cached SMInstance</p></li>
<li><p><strong>annotation_filter</strong> – Additional keyword arguments passed to the METASPACE API.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://spatialdata.scverse.org/en/latest/generated/spatialdata.SpatialData.html#spatialdata.SpatialData" title="(in Python v0.0.16.dev47+g4166360)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpatialData</span></code></a></span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>A <code class="xref py py-class docutils literal notranslate"><span class="pre">SpatialData</span></code> object with</dt><dd><ul class="simple">
<li><p>ion intensities and metadata: <code class="docutils literal notranslate"><span class="pre">.table</span></code></p></li>
<li><p>optical image: <code class="docutils literal notranslate"><span class="pre">.images[&quot;optical_image&quot;]</span></code> (or <code class="docutils literal notranslate"><span class="pre">optical_name_added</span></code>)</p></li>
<li><p>sampling coordinates: <code class="docutils literal notranslate"><span class="pre">.points[&quot;maldi_points&quot;]</span></code> (or <code class="docutils literal notranslate"><span class="pre">points_name_added</span></code>) in a
coordinate system relative to the top-left image corner and physical scale
(micrometers)</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.12)"><strong>ValueError</strong></a> – If something is wrong with the input data or parameters</p></li>
<li><p><a class="reference external" href="https://metaspace2020.readthedocs.io/en/latest/content/apireference/sm_annotation_utils.html#metaspace.sm_annotation_utils.DatasetNotFound" title="(in metaspace2020)"><strong>metaspace.sm_annotation_utils.DatasetNotFound</strong></a> – If the dataset ID is not found</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ConnectionError" title="(in Python v3.12)"><strong>ConnectionError</strong></a> – For any other network connectivity problems</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-metaspace_converter.colocalization">
<span id="metaspace-converter-colocalization"></span><h2>metaspace_converter.colocalization<a class="headerlink" href="#module-metaspace_converter.colocalization" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="metaspace_converter.colocalization.coloc_ml_preprocessing">
<span class="sig-prename descclassname"><span class="pre">metaspace_converter.colocalization.</span></span><span class="sig-name descname"><span class="pre">coloc_ml_preprocessing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'coloc_ml_preprocessing'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">median_filter_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(3,</span> <span class="pre">3)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantile_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/metaspace_converter/colocalization.html#coloc_ml_preprocessing"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#metaspace_converter.colocalization.coloc_ml_preprocessing" title="Link to this definition"></a></dt>
<dd><p>Preprocessing for colocalization analysis according to the colocML publication
(<a class="reference external" href="https://doi.org/10.1093/bioinformatics/btaa085">https://doi.org/10.1093/bioinformatics/btaa085</a>).</p>
<p>In the publication, the authors evaluated colocalization metrics and preprocessing approaches.
They found the best performance for</p>
<ol class="arabic simple">
<li><p>median filtering of ion images with a (3, 3) kernel size and</p></li>
<li><p>quantile thresholding at 50%, meaning all pixels with intensities below the 50%
quantile set to 0.</p></li>
</ol>
<p>This function performs the same preprocessing steps.
Recommended for call before running the <code class="docutils literal notranslate"><span class="pre">colocalization</span></code> function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://anndata.readthedocs.io/en/stable/generated/anndata.AnnData.html#anndata.AnnData" title="(in anndata v0.1.dev50+gce7fc76)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></a></span>) – An AnnData object.</p></li>
<li><p><strong>layer</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>]</span>) – Key for the adata.layers dict in which the processed data will be saved.
Default value is <code class="docutils literal notranslate"><span class="pre">colocml_preprocessing</span></code>.
If None, <code class="docutils literal notranslate"><span class="pre">adata.X</span></code> will be overwritten with the processed data.</p></li>
<li><p><strong>median_filter_size</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>]</span>) – 2-dimensional filter size for the median filtering that
will be performed per ion image.</p></li>
<li><p><strong>quantile_threshold</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a></span>) – Float between 0 and 1. The function computes the quantile value per
ion image and all pixels below the quantile threshold will be set to 0.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None. The processed data is saved in <code class="docutils literal notranslate"><span class="pre">layer</span></code>. If layer is set to None, <code class="docutils literal notranslate"><span class="pre">adata.X</span></code> will
be overwritten</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.12)"><strong>ValueError</strong></a> – If no annotations are available in <code class="docutils literal notranslate"><span class="pre">adata.X</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="metaspace_converter.colocalization.colocalization">
<span class="sig-prename descclassname"><span class="pre">metaspace_converter.colocalization.</span></span><span class="sig-name descname"><span class="pre">colocalization</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'coloc_ml_preprocessing'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/metaspace_converter/colocalization.html#colocalization"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#metaspace_converter.colocalization.colocalization" title="Link to this definition"></a></dt>
<dd><p>Colocalization of ion images using the cosine similarity metric.</p>
<p>In combination with the <code class="docutils literal notranslate"><span class="pre">colocML_preprocessing</span></code> function, this metric performed best in the
colocML publication (<a class="reference external" href="https://doi.org/10.1093/bioinformatics/btaa085">https://doi.org/10.1093/bioinformatics/btaa085</a>).</p>
<p>It is recommended to call the <code class="docutils literal notranslate"><span class="pre">coloc_ml_preprocessing</span></code> function beforehand.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://anndata.readthedocs.io/en/stable/generated/anndata.AnnData.html#anndata.AnnData" title="(in anndata v0.1.dev50+gce7fc76)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnnData</span></code></a></span>) – An AnnData object.</p></li>
<li><p><strong>layer</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>]</span>) – Key for <code class="docutils literal notranslate"><span class="pre">adata.layer</span></code> from which the ionimage_data for preprocessing taken.
If <code class="docutils literal notranslate"><span class="pre">None</span></code>, <code class="docutils literal notranslate"><span class="pre">adata.X</span></code> is used. <code class="docutils literal notranslate"><span class="pre">coloc_ml_preprocessing</span></code> will save the preprocessed
data per default in <code class="docutils literal notranslate"><span class="pre">adata.layer['coloc_ml_preprocessing']</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None. The processed data is saved in <code class="docutils literal notranslate"><span class="pre">adata.varp['colocalization']</span></code>.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.12)"><strong>ValueError</strong></a> – If layer is not found in adata.layers.</p>
</dd>
</dl>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to METASPACE Converter’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023; Tim Daniel Rose, Andreas Eisenbarth, Theodore Alexandrov.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>